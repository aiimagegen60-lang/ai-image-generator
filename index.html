<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Image Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;background:#0b0b0b;color:#fff;font-family:Arial}
header{padding:14px;text-align:center;font-size:20px;background:#161616;position:sticky;top:0}
.container{padding:15px}
textarea{width:100%;height:90px;padding:12px;border-radius:10px;border:none;font-size:16px}
button{width:100%;margin-top:12px;padding:14px;font-size:16px;
border:none;border-radius:10px;font-weight:bold;background:#00e676;color:#000}
#status{text-align:center;color:#aaa;margin-top:10px}

.image-box{margin-top:15px;min-height:320px;background:#111;border-radius:12px;
display:flex;align-items:center;justify-content:center}

.hidden{display:none !important}

/* POPUP */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.popup.show{display:flex}
.popup-box{
  background:#161616;
  padding:20px;
  border-radius:14px;
  width:90%;
  max-width:320px;
  text-align:center;
}
.popup-box button{margin-top:12px}
</style>
</head>

<body>

<header>ü§ñ AI Image Generator</header>

<div class="container" id="gen">
<textarea id="prompt" placeholder="Describe your image..."></textarea>
<button id="genBtn">‚ö° Generate Image</button>
<div id="status"></div>
<div class="image-box" id="result">
  <span style="color:#666">Generated image will appear here</span>
</div>
</div>

<!-- POPUP -->
<div class="popup" id="adPopup">
  <div class="popup-box">
    <h3>üîí Unlock Generation</h3>
    <p id="countdown">Please wait 15 seconds</p>
    <button id="continueBtn" disabled>Continue</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  /* ===== CONFIG ===== */
  const WORKER_URL = "https://fragrant-salad-e7eb.aiimagegen60.workers.dev";

  /* ===== ELEMENTS ===== */
  const genBtn = document.getElementById("genBtn");
  const status = document.getElementById("status");
  const result = document.getElementById("result");
  const popup = document.getElementById("adPopup");
  const countdown = document.getElementById("countdown");
  const continueBtn = document.getElementById("continueBtn");
  const promptEl = document.getElementById("prompt");

  /* ===== STATE ===== */
  let count = parseInt(localStorage.getItem("gen_count") || "0");
  let locked = localStorage.getItem("gen_locked") === "true";
  let timer = null;

  /* ===== SAFETY RESET ===== */
  if (locked && count < 4) {
    locked = false;
    localStorage.setItem("gen_locked","false");
  }

  /* ===== GENERATE ===== */
  genBtn.onclick = async () => {
    if (locked) {
      showPopup();
      return;
    }

    const p = promptEl.value.trim();
    if (!p) { alert("Enter prompt"); return; }

    status.innerText = "‚è≥ Generating‚Ä¶";
    genBtn.disabled = true;

    try{
      const res = await fetch(WORKER_URL,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ prompt:p })
      });

      if (!res.ok) throw "server";

      const type = res.headers.get("content-type") || "";
      if (!type.startsWith("image/")) throw "busy";

      const blob = await res.blob();
      const url = URL.createObjectURL(blob);

      result.innerHTML = `<img src="${url}" style="width:100%;border-radius:12px">`;

      count++;
      localStorage.setItem("gen_count", count);
      if (count >= 4) {
        locked = true;
        localStorage.setItem("gen_locked","true");
      }

      status.innerText = "‚úÖ Done";
    }catch{
      status.innerText = "‚ùå Server busy, try again";
    }

    genBtn.disabled = false;
  };

  /* ===== POPUP LOGIC ===== */
  function showPopup(){
    popup.classList.add("show");
    continueBtn.disabled = true;

    let t = 15;
    countdown.innerText = `Please wait ${t} seconds`;

    if (timer) clearInterval(timer);
    timer = setInterval(()=>{
      t--;
      countdown.innerText = `Please wait ${t} seconds`;
      if (t <= 0) {
        clearInterval(timer);
        countdown.innerText = "You can continue";
        continueBtn.disabled = false;
      }
    },1000);
  }

  continueBtn.onclick = () => {
    if (timer) clearInterval(timer);
    popup.classList.remove("show");

    count = 0;
    locked = false;
    localStorage.setItem("gen_count","0");
    localStorage.setItem("gen_locked","false");

    status.innerText = "üîì Unlocked. Generate again.";
  };

});
</script>

</body>
</html>
